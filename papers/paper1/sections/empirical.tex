\section{Emperical study}

The purpose of the computational study is to answer the following questions:

[General intro see e.g. https://www.research.relund.dk/publications/pdf/forget22b.pdf and https://www.research.relund.dk/publications/pdf/forget22a.pdf]

\begin{enumerate}
    \item How large is $|\Yn|$ given $|\Yn^s|, s\in S$ ($\prod_s |\Yn^s|)$?
    \item What is the relative size of the generator sets compared to $|\Yn^s|, s\in S$?
    \item Does the sequence of subproblems impact the generator set size? 
\end{enumerate}

\subsection{Test instances}

Possible setup: In an instance folder, create a subfolder for each instance = problem. Keep on csv file for each subproblem. Even better could be to have no subfolders but instead one json file for each instance. Another solution is to have a json file for each subproblem. This is properly the best option. However, the instances will be correlated. An instance can then be defined as a combination of subproblems.

For each subproblem we

\begin{itemize}
    \item Test $p=2,\ldots, 5$. [4 options]
    \item Width is the same for all objectives (\cite{Kerberenes2022phd} use $w_i=1000$ in Chap. 2) or width is the same for approx. half of the objectives (\eg 1000) and 1/4 for the remaining (\ie 250). [2 options]
    \item Generate on a sphere: either lower/west part (many supported) or upper/east part (many unsupported). [2 options]
    \item Generate $10, 50, 100, 150, 200$ points and find the nd points among them for each subproblem. [5 options]
    \item Classify each nd point (supported, extreme, unsupported)
    \item Keep statistics: number of points, supported, extreme, unsupported, ratio = supported/unsupported, (range) width $w_i$ = max-min, min and max value for each objective $i = 1,\ldots p$.
    \item 5 instances for each config. [5 options]
\end{itemize}

In total $4 \cdot 2 \cdot 2 \cdot 2 \cdot 5 \cdot 5 = 800$ files. Naming convention could be 

\verb|sub-<id>-<p>-<width>-<sphere-method>-<nd-points>-<ratio>-<instance-id>.json|.


Note that given integer points, an upper bound on the width of the master problem with $s = 1,\ldots, m$ subproblems is $w_i = \sum_s w_{si}$. That is, if we keep the width of the subproblem fixed, the width of the master grows as $m$ grows. 

Note that given integer points and $p=2$, an upper bound on the number of nd points is $1 + \min_i w_i$. For a problem with $m$ subproblems an upper bound on the nd points is $1 + \min_i \sum_p w_{pi}$

The following instance/problem groups are generated given combinations of (this should maybe be changed for each question):

\begin{itemize}
    \item $p=2,\ldots, 5$. [4 options]
    \item $m=2,\ldots 5$ where $m$ is the number of subproblems. [4 options]
    \item All subproblems have the same sphere config, half/half. [3 options]
    \item Increasing nd points in subproblems (if m=3 choose 100, 200, 250), all have highest (n=250). [2 options]
    \item 10 instances for each config. [10 options]
\end{itemize}

In total $4 \cdot 4 \cdot 3 \cdot 2 \cdot 10 = 960$ files. Naming convention could be 

\verb|prob-<id>-<p>-<m>-<sphere-method>-<sub-ids>.json|.

A result file in the format \href{https://github.com/MCDMSociety/MOrepo/blob/master/contribute.md}{MCDMSociety}   may be created.



\subsection{Emperical study of Generator sets}
When are generator sets small relative to the non-dominated sets?

\subsection{Emperical study of Generator upper bound sets}
When are upper bound sets from generators 'good'. (make precise)?


\subsection{Emperical study of information-sharing between subproblems}
***RQ? Formulate major research questions.

\begin{itemize}
	\item 
Generate a new point from a subproblem and update all generator sets and upper bound sets.
	\item 
Periodically generate a point for each subproblem whereafter all generator sets and upper bound sets are updated.
	\item 
Sweep: generate all supported non-dominated points for each subproblem whereafter all generator sets and upper bound sets are updated.
\end{itemize}



\subsection{Methods for answering research questions}

In the following we describe ways of generating test metrics used to answer the main empirical research questions. Each test is performed on an \msp instance given by a sequence of sets $\{\Y^s\}_{s \in \S}$ for some ordered sequence of subproblems indexed by a set $\S$ (where we assume $\Y^s \subseteq \Yn^s \forall s \in \S$).

\begin{enumerate}
	\item  How large is $\lvert \Yn \rvert$ given $\left\{\lvert \Yn^s \rvert \right\}_{s \in \S}$?
To determine the set $\Yn$ we run the naive Minkowski Sum filtering algorithm from \citep{Kerberenes2022}. This algorithm sequentially generates the nondominated Minkowski Sum and uses a nondominance filter as a subroutine. The speed of the nondominance algorithm differs for $p=2$ and for $p>2$.

In each test we record the following measures:
\begin{itemize}
	\item 
$\lvert \Yn \rvert$ total nondominated points.
	\item 
$\lvert \Ysn \rvert$ total supported nondominated points.
	\item 
$\lvert \Yen \rvert$ total extreme (supported) nondominated points.
	\item 
$\lvert \Yn \setminus \Ysn \rvert$ total unsupported nondominated points.
\end{itemize}



\item What is the relative size of the generator sets compared to $\lvert \Y^s \rvert (\forall s \in \S)$?
We first note that generator sets are not unique. We consider several different generator sets and compare. We define a \emph{Minimum generator set sequence} as a sequence of generators $\left\{ \Ycs  \right\}_{s \in \S}$ where $\Ycs \subseteq \Y^s$ such that $\bar{M} := \sum_{s \in \S} \lvert \Ycs \rvert$ is minimum.

Let $\bar{M}$ denote the size of a minimum generator set sequence. $\bar{M}$ is defined by the following combinatorial problem.

\begin{align}
	\bar{M}  =  \min& \sum_{s \in \S} \lvert \hY^s \rvert  \\
	s.t. \quad & \msum_{s \in \S} \lvert \hY^s \rvert = \Yn,  \label{constr:comb spanning}\\
		   & \hY^s \subseteq \Y^s, \quad \forall s \in \S
\end{align}

We will reformulate the combinatorial problem as a general MIP. To do this we introduce the following notation. We order the sets $\Y^s := \{y^s_1,\hdots\} = \{\Y_i^s\}_{s \in \I^s}$ indexed by set $\I^s$ for all subproblems $s \in s \in \S$. Likewise, we order the set $\Yn := \{y_j\}_{j \in \J}$ indexed by the set $\J$. We introduce decision variables $x$ and $w$ such that:
\begin{align}
	x^s_i &= \begin{cases}
    	1, &\text{ if }y_i^s \in \hY^s \\ 
    	0, &\text{ otherwise }\\ 
    \end{cases}
    & \forall i \in \I^s, \forall s \in \S
    \\
		w^s_{i,j} &= \begin{cases}
    	1, &\text{ if $y^s_i$ generates $y_j \in \Yn$} \\ 
    	0, &\text{ otherwise }\\ 
    \end{cases}
    & \forall i \in \I^s, \forall s \in \S, \forall j \in \J \nonumber
\end{align}
To enforce the definitions of the decision variables we add the following constraints.
\begin{align}
    w^s_{i,j} \le x^s_i, \quad \forall i \in \I^s, \forall s \in \S, \forall j \in \J \label{constr:MIP-subset-chosen}
\end{align}
That is, $y^s_i$ can only be part of generating $y_j$ (for any $j$) if $y^s \in \hY^s$. We now add constraints which ensure that each point in the set $\Yn$ is 'generated' by some combination of points of the subproblems:
\begin{align}
    \sum_{s \in \S}\sum_{i \in \I^s} w^s_{i,j} y^s_i = y_j, \quad \forall j \in \J \label{constr:MIP-generating}
\end{align}
Finally, each point $y \in \Yn$ must be a combination of exactly one point from each subproblem:
\begin{align}
    \sum_{i \in \I^s} w^s_{i,j} = 1, \quad \forall s \in \S, \forall j \in \J \label{constr:MIP-combination-single}
\end{align}
The constraints \Cref{constr:MIP-subset-chosen} together with \Cref{constr:MIP-combination-single} also ensures that at least one solution is chosen to each subproblem $\left( \sum_{i \in I^s} x^s_i \right) \forall s \in \S $.
The objective function is the sum of the chosen generator points: $\bar{M} := \sum_{s \in \S}\sum_{i \in \I^s} x^s_i$. This results in the following MIP:

\begin{align*}
	\bar{M}  := \min&  \sum_{s \in \S}\sum_{i \in \I^s} x^s_i \\
	s.t. \quad & w^s_{i,j} \le x^s_i & \forall i \in \I^s, \forall s \in \S, \forall j \in \J \\
		   &\sum_{s \in \S}\sum_{i \in \I^s} w^s_{i,j} y^s_i = y_j & \quad \forall j \in \J \\
		   &\sum_{i \in \I^s} w^s_{i,j} = 1 & \quad \forall s \in \S, \forall j \in \J  \\
		   & x^s_i \in \{0,1\} & \forall i \in \I^s, \forall s \in \S\\
		   & w^s_{i,j} \in \{0,1\} &\forall i \in \I^s, \forall s \in \S, \forall j \in \J \nonumber
\end{align*}
Given an optimal solution $(\bar{x},\bar{w})$ the corrospinding generator sets $\Ycs$ is gives as $\Ycs = \{ y^s_i \in \Y^s : \bar{x}^s_i = 1\}$.

For each test we record:
\begin{itemize}
	\item Total points, supported points, extreme (supported) points, unsupported nondominated points.
	\item Global $\lvert \Yn \rvert$, $\lvert \Ysn \rvert$,  $\lvert \Yen \rvert$, $\lvert \Yn \setminus \Ysn \rvert$.
	\item Subproblems (already known)  $\lvert \Yn^s \rvert$, $\lvert \Ysn^s \rvert$,  $\lvert \Yen^s \rvert$, $\lvert \Yn^s \setminus \Ysn^s \rvert$ $\forall s \in \S$.
	\item Generator sets $\lvert \Ycs \rvert$, $\lvert \Ycs \cap \Ysn^s \rvert$, $\lvert \Ycs \cap \Yen^s \rvert$,  $\lvert \Ycs \setminus \Ysn^s \rvert$  $\forall s \in \S$
	\item $\bar{M}$
\end{itemize}





\end{enumerate}


%\subsubsection{}


